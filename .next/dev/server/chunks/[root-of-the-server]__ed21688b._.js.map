{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/game168-/app/api/campaigns/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst SUPABASE_SERVICE_ROLE = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst API_KEY = process.env.API_KEY || null;\nconst BUCKET = process.env.SUPABASE_BUCKET || \"campaign-images\";\n\nfunction getServerClient() {\n  if (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE) {\n    throw new Error(\"Missing SUPABASE URL or SERVICE ROLE KEY in environment\");\n  }\n  return createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE);\n}\n\nasync function verifyAuth(req) {\n  // returns user object if valid token provided, otherwise null\n  try {\n    const authHeader = req.headers.get(\"authorization\") || \"\";\n    const token = authHeader.startsWith(\"Bearer \") ? authHeader.split(\" \")[1] : null;\n    if (!token) return null;\n    const server = getServerClient();\n    const { data, error } = await server.auth.getUser(token);\n    if (error) return null;\n    return data?.user || null;\n  } catch (err) {\n    return null;\n  }\n}\n\nexport async function GET() {\n  const client = createClient(SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\");\n  const { data, error } = await client.from(\"campaigns\").select(\"*\").order(\"id\", { ascending: false });\n  if (error) return NextResponse.json({ error: error.message }, { status: 500 });\n  return NextResponse.json(data);\n}\n\nexport async function POST(req) {\n  try {\n    // allow either API_KEY or valid authenticated user\n    if (API_KEY) {\n      const provided = req.headers.get(\"x-api-key\");\n      if (provided !== API_KEY) {\n        // if no API key match then require valid user token\n        const user = await verifyAuth(req);\n        if (!user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n      }\n    } else {\n      const user = await verifyAuth(req);\n      if (!user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const body = await req.json();\n    const server = getServerClient();\n\n    const { data, error } = await server\n      .from(\"campaigns\")\n      .insert([\n        {\n          title: body.title,\n          description: body.description,\n          image: body.image || null,\n        },\n      ])\n      .select();\n\n    if (error) return NextResponse.json({ error: error.message }, { status: 500 });\n    return NextResponse.json(data);\n  } catch (err) {\n    return NextResponse.json({ error: err.message }, { status: 500 });\n  }\n}\nimport { supabase } from \"@/lib/supabase\";\n\nexport async function GET() {\n  const { data, error } = await supabase.from(\"campaigns\").select(\"*\");\n\n    if (error) return Response.json({ error: error.message }, { status: 500 });\n\n      return Response.json(data);\n      }\n\n      export async function POST(req) {\n        const body = await req.json();\n\n          const { data, error } = await supabase\n              .from(\"campaigns\")\n                  .insert([\n                        {\n                                title: body.title,\n                                        description: body.description,\n                                                image: body.image || null,\n                                                      },\n                                                          ])\n                                                              .select();\n\n                                                                if (error) return Response.json({ error: error.message }, { status: 500 });\n\n                                                                  return Response.json(data);\n                                                                  }"],"names":[],"mappings":"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"}}]
}